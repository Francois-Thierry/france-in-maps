<!doctype html>
<html lang="en"class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title class="EN">France in maps</title>
  <title class="FR">La France en cartes</title>

  <link rel="stylesheet" href="../assets/main.css">

  <script src="../assets/external/jquery-3.1.0.min.js"></script>
  <script src="../assets/external/xlsx.full.min.js"></script>
  <script src="../assets/external/d3.v4.2.4.min.js"></script>
  <script src="../assets/external/topojson.v2.min.js"></script>

  <!-- Helpful ressources -->
  <!-- http://madewithenvy.com/ecosystem/articles/2015/local-maps-with-canvas-d3/ -->
  <!-- http://chimera.labs.oreilly.com/books/1230000000345/ch12.html -->
  <!-- https://jgaffuri.github.io/france2json/revenues_map.html -->


</head>
<body>

<div class="wrapper">
  <div class="header"></div>
  <div class="row">
  	<div class="column-12">
      <h1 class="EN">France in maps</h1>
      <h1 class="FR">La France en cartes</h1>
  		<p class="EN">
  			This webpage is an ongoing cartographic test. I want to map open data from data.gouv.fr. Ideally it would reproduce the same type of maps than in the excellent book "Le mystère français" from Hervé Le Bras and Emmanuel Todd and add interactivity by selecting datasets and available periods.  			
  		</p>
  		<p class="FR">
  			Cette page est un test de cartographie des données de l'INSEE. Idéalement elle devrait permettre de produire le même type de carte que celles de l'excellent livre "Le mystère français" de Hervé Le Bras et Emmanuel Todd et ajouter de l'interactivité en choisissant parmi les données et les périodes disponibles.
  		</p>
  		
  	</div>
    <div class="row plot column-12">
      <div class="column-12" style="display:inline-flex;">
        <h3 id="regions2015" class="active">Régions (2015)</h3>
        <h3 id="regions">Régions</h3>
        <h3 id="departements">Départements</h3>
        <h3 id="cantons">Cantons</h3>
        <h3 id="communes">Communes</h3>
      </div>
      <div>
        <canvas id="map"></canvas>
      </div>
    </div>
  </div>
  <div class="detailsSection column-12">
    <h3 class="EN">Details</h3>
    <h3 class="FR">Détails</h3>
    <div class="details">
      <div class="line-separator"></div>
      <div class="column-12">      
        <p class="EN">
          I use shape files from <a href="https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/" target="_blank">data.gouv.fr</a> (2015 version simplified at 100m). The problem with this file is that it weights 15.5 Mb so it's a long loading and that it isn't directly usable on github. I started by converting the .shp file into GeoJSON format using ogr2ogr from the Geospatial Data Abstraction Library (<a href="http://www.gdal.org/" target="_blank">GDAL</a>).
        </p>   
        <p class="FR">
          J'utilise des fichiers formes provenant de <a href="https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/" target="_blank">data.gouv.fr</a> (version 2015 simplifiée à 100m). Le problème de ce fichier est qu'il pèse 15.5 Mb ce qui ralentit le chargement et le fait qu'il ne soit pas utilisable directement sur github. J'ai commencé par convertir le fichier .shp en GeoJSON en utilisant ogr2ogr de la librairie d'abstraction de données géospatiales (<a href="http://www.gdal.org/" target="_blank">GDAL</a>). 
        </p>
        <p class="code">
          ogr2ogr -f GeoJSON -t_srs crs:84 geo.json communes-20150101-100m.shp
        </p>
        <p class="EN">
          The GeoJSON file produced is even bigger (43.5 Mb), I then used <a href="https://github.com/topojson/topojson">TopoJSON</a> to compress it and drastically reduce the file size (11 Mb!!) in order to minimize the loading time.
        </p>
        <p class="FR">
          Le fichier GeoJSON obtenu est plus volumineux (43.5 Mb), j'utilise <a href="https://github.com/topojson/topojson">TopoJSON</a> pour le compresser et ainsi réduire la taille du fichier (11 Mb!!) afin d'accélérer le chargement.
        </p>
        <p class="code">
          geo2topo -o topo.json -q 1e5 geo.json
        </p>
        <p class="EN">
          I then deleted the attributes that I didn't needed (wikipedia, surf_m2 and nom) and I added the geographic codes corresponding to each geometry with a Python script. This increases slightly the size of the file (11.6 Mb), I finally simplified the topology with TopoJSON-simplify to obtain a final size of 9.6Mb.
        </p>
        <p class="FR">
          J'ai ensuite retirer les attributs dont je n'avais pas besoin ("wikipedia", "surf_m2" et "nom") et j'ai rajouté l'appartenance géographique pour chaque commune à l'aide d'un script Python. Cela augmente légérement la taille du fichier (11.6 Mb), j'ai finalement simplifié la topologie avec TopoJSON-simplify pour obtenir un fichier de 9.6Mb.
        </p>
        <p class="code">
          toposimplify -o topo_s.json -p 1e-4 topo.json
        </p>
        <p class="EN">
          Thanks to the geographic codes (and TopoJSON) we display different administrative levels ("communes" - "cantons" - "départements" - "régions") with the same data by merging geometries that have attributes in common.
        </p>
        <p class="FR">
          Grâce aux attributs (et à TopoJSON) on affiche différents niveaux de résolutions (communes - cantons - départements - régions) avec les mêmes données en fusionnant les géométries qui ont des attributs en commun.
        </p>
      </div>
      <div class="line-separator"></div>
    </div>
  </div>
  <div class="footer"></div>
</div>
<!-- ----------------------------------------------------------------------- -->
<!--                                                              Javascript -->
<!-- ----------------------------------------------------------------------- -->

<script src="../assets/main.js"></script>
<script src="france-in-maps.js"></script>

</body>
</html>